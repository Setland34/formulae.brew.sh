---
---
{%- assign fname = page.name | remove: ".json" -%}
{%- assign data_fname = fname | remove: "@" | remove: "." | replace: "+", "_" -%}
{%- assign fdata = site.data.formula[data_fname] -%}
{

{%- for key_value in fdata -%}
  {{ key_value[0] | jsonify }}:{{ key_value[1] | jsonify }},
{%- endfor -%}

"analytics":{
{%- for category in site.analytics.categories.formulae -%}
  "{{ category.path | replace: "-", "_" }}":{
  {%- for interval in site.analytics.intervals -%}
    "{{ interval.path }}":{
    {%- for fa in site.data.analytics[category.path].homebrew-core[interval.path].formulae[fname] -%}
      {{ fa.formula | jsonify }}:{{ fa.count | remove: "," | plus: 0 }}
      {%- unless forloop.last -%}
      ,
      {%- endunless -%}
    {%- else -%}
      {{ fname | jsonify }}:0
    {%- endfor -%}
    }
    {%- if category.path == "build-error" -%}
      {%- break -%}
    {%- endif -%}
    {%- unless forloop.last -%}
    ,
    {%- endunless -%}
  {%- endfor -%}
  }
  {%- unless forloop.last -%}
  ,
  {%- endunless -%}
{%- endfor -%}
},
"mac_dependencies": [
  {%- for dep in fdata.mac_dependencies -%}
    {
      "name": "{{ dep.name }}",
      "version": "{{ dep.version }}"
    }
    {%- unless forloop.last -%}
    ,
    {%- endunless -%}
  {%- endfor -%}
],
"linux_dependencies": [
  {%- for dep in fdata.linux_dependencies -%}
    {
      "name": "{{ dep.name }}",
      "version": "{{ dep.version }}"
    }
    {%- unless forloop.last -%}
    ,
    {%- endunless -%}
  {%- endfor -%}
],
"mac_caveats": "{{ fdata.mac_caveats | escape }}",
"linux_caveats": "{{ fdata.linux_caveats | escape }}",
"generated_date":"{{ "today" | date: "%F" }}"}
